#:kivy 1.9.1
#:import webbrowser webbrowser
#:import icon ui.iconfonts

<RootLayout>:
    padding:[0,0,0,20]
    spacing: 15
    canvas:
        Color:
            rgba:.95,.95,1,.6
        Rectangle:
            texture: self.back_texture.texture
            pos:self.pos
            size:self.size

<Label>:
    color:.9, .95, .95, .9

<HoLine@FloatLayout>:
    size_hint:1,None
    height: 2
    canvas:
        Color:
            rgba:[.4, .6, .65, .35]
        Rectangle:
            size: self.size
            pos: self.pos

<SpacedVeLine@FloatLayout>:
    size_hint: None,1
    width: 3
    canvas:
        Color:
            rgba:[.4, .6, .65, .35]
        Rectangle:
            size:(2,self.size[1])
            pos: self.pos[0] + self.width / 2 ,self.pos[1]

<SpacedHoLine@FloatLayout>:
    size_hint:1,None
    height: 17
    canvas:
        Color:
            rgba:[.4, .6, .65, .35]
        Rectangle:
            size:(self.size[0],2)
            pos: self.pos[0] ,self.pos[1] + self.height / 2 -2


<SpacingLayout@FloatLayout>:
    size_hint: 1,None
    height: 15

<BigSpacingLayout@FloatLayout>:
    size_hint: 1,None
    height: 30



<FlatButton>:
    canvas:
        Color:
            rgba:self.underline_color
        Rectangle:
            size: self.size[0]  , 1
            pos:self.pos[0], self.pos[1]
            # points: [self.pos[0]+self.width * .2  , self.pos[1], self.pos[0]+self.width * .8 ,self.pos[1]]
            # width: 1

<FilterCheckBox@CheckBox>:
    active: True
    ext: ""

<LeftLayout>:
    spacing: 2
    size_hint: 1.05,1
    orientation:"vertical"
    AnimatedBoxLayout:
        id:tree_button_layout
        size_hint: 1, None
        size:0,36
        Carousel:
            direction: "top"
            scroll_distance:100000000
            scroll_timeout: 10
            anim_move_duration:.3
            id: filter_carousel
            BoxLayout:
                spacing: self.width / 9
                FlatButton:
                    text: "%s  Back"%(icon.icon('fa-arrow-left',16,self.icon_color))
                    on_press: app.tree_view.is_multiple_selection = False
                FlatButton:
                    text: "%s  Something"%(icon.icon('fa-hourglass',16,self.icon_color))
                    on_press: print app.tree_view.selected_nodes
                FlatButton:
                    text: "%s  Add"%(icon.icon('fa-arrow-right',16,self.icon_color))
                    on_press: app.selected_list_node_add_handler(None,app.tree_view.selected_nodes)
                    on_release: app.tree_view.clear_selection()
            BoxLayout:
                spacing: self.width / 9
                FlatButton:
                    text:"%s  Open"%(icon.icon('fa-folder',16,self.icon_color))
                    on_press: app.change_explorer()
                FlatButton:
                    text:"%s  Refresh"%(icon.icon('fa-refresh',16,self.icon_color))
                    on_press: app.tree_refresh()
                FlatButton:
                    text: "%s  Filter"%(icon.icon('fa-filter',16,self.icon_color))
                    on_release: app.change_carousel(filter_carousel,2)

            BoxLayout:
                GridLayout:
                    spacing: 4
                    cols: 6
                    Label:
                        text:"FLAC"
                    Label:
                        text: "ALAC"
                    Label:
                        text: "OGG"
                    Label:
                        text: "WMA"
                    Label:
                        text: "AIFF"
                    Label:
                        text: "MP3"
                    FilterCheckBox:
                        id: FLAC_ch
                        ext: "flac"
                    FilterCheckBox:
                        id: ALAC_ch
                        ext: "m4a"
                    FilterCheckBox:
                        id: OGG_ch
                        ext: "ogg"
                    FilterCheckBox:
                        id: WMA_ch
                        ext: "wma"
                    FilterCheckBox:
                        id: AIFF_ch
                        ext: "aiff"
                    FilterCheckBox:
                        id: MP3_ch
                        ext: "mp3"
                FlatButton:
                    size_hint: 0.2,1
                    text: "Filter"
                    on_press: app.files_filter_handler()
                    on_release: app.change_carousel(filter_carousel,1)
    SpacedHoLine:

<CenterLayout>:
    size_hint:1.2,1
    spacing: 2
    AnimatedBoxLayout:
        size_hint:1,None
        height: 35
        BoxLayout:
            padding:30,0,30,0
            spacing: self.width / 10
            ToggleFlatButton:
                text: "Metador"
                on_press:app.change_carousel(app.center_carousel, 0)
                group: "Converter"
                state: "down"
            ToggleFlatButton:
                text: "File Converter"
                on_press:app.change_carousel(app.center_carousel, 1)
                group: "Converter"


<BorderLessNode>:
    canvas.before:
        Color:
            rgba:self.color_selected_ms if self.is_selected and self.is_ms else self.color_selected if self.is_selected else self.even_color
        Rectangle:
            pos: [self.parent.x, self.y] if self.parent else [0, 0]
            size: [self.parent.width, self.height] if self.parent else [1, 1]
    canvas.after:
        Clear

<RootNode>:
    width: self.texture_size[0]
    height: max(self.texture_size[1] + dp(10), dp(24))
    text_size: self.width, None


<FileNode>:
    height:node_label.size[1]
    padding: 5,0
    spacing: 10
    Label:
        padding_y: 5
        size: root.width,self.texture_size[1] + 8
        text_size: self.size[0],None
        halign: "left"
        mipmap: False
        bold: False
        shorten: not(root.is_selected)
        text: root.text
        shorten_from: "right"
        id: node_label
        canvas:
            Color:
                rgba: .6, .75, .8, 0.6
            Rectangle:
                texture:root.file_icon.texture
                pos: root.pos[0] -20, root.center_y -7
                size: (15, 15)
    Label:
        size_hint: None,1
        font_size: 14
        width: self.texture_size[0]
        text: "{} MB".format(root.file_size)
    #SimpleTransparentButton:
        #size_hint: None,1
        #width: 20
        #text: "%s"%(icon.icon("fa-plus",16,self.icon_color))
        #on_release: app.file_doubleclick_handler(None,root)


<ListNode>:
    FloatLayout:
        size_hint:None,1
        width: 2
    Label:
        size_hint: None,1
        width: self.texture_size[0]
        text: "{}".format(root.file_duration)




<FolderNode>:
    height:node_label.size[1]
    padding: 5,0
    droppable_zone_objects:[app.center_layout,]
    drop_func: self.debug
    Label:
        padding_y: 5
        size: root.width,self.texture_size[1] + 8
        text_size: self.size[0],None
        halign: "left"
        mipmap: True
        bold: False
        shorten: not(root.is_selected)
        text: root.text
        shorten_from: "right"
        id: node_label
        canvas:
            Color:
                rgba: root.folder_color_sub_nodes if root.is_sub_nodes else root.folder_icon_color
            Rectangle:
                texture:root.file_icon.texture
                pos: root.pos[0] -37, root.center_y -7
                size: (17, 13)

<ScrollableLabel>:
    canvas:
        Color:
            rgba:.4,.42,.45,0
        Line:
            points:[self.pos[0], self.pos[1], self.pos[0]+self.width, self.pos[1],self.pos[0]+self.width, self.pos[1] + self.height,self.pos[0],self.pos[1]+self.height,self.pos[0],self.pos[1]]
        Color:
            rgba:0,0,0,.0
        Line:
            points:[self.pos[0]+self.width -3, self.pos[1]+3,self.pos[0]+self.width -3, self.pos[1] + self.height -3,self.pos[0]+3,self.pos[1]+self.height-3,self.pos[0]+3,self.pos[1]+3]
            width:1
        Color:
            rgba: 0,0,0,.0
        Rectangle:
            pos:self.pos
            size:self.size
    Label:
        padding:10,10
        size_hint_y: None
        height: self.texture_size[1]
        text_size: self.width, None
        text: root.text
        font_size: root.font_size


<EditorLabel>:
    size_hint: None,None
    size: 29,29
    bold:True
    markup:True

<EditorTextInput>:
    size_hint:1,None
    size: 0,31
    multiline: False
    use_bubble: False
    hint_text_color: [.6, .7, .7, 0.7]
    text: ""
    cursor_color: .4, .8, .8, 1
    background_color: [0 ,0.1, .1,0]
    foreground_color: .9,.9,.9,1
    canvas.after:
        Color:
            rgba: self.underline_color
        Rectangle:
            size: self.size[0], .75
            pos:self.pos


<TagEditorLayout>:
    spacing:15
    orientation: "vertical"
    padding:[10,0,0,10]
    Carousel:
        direction: "bottom"
        scroll_distance:100000000
        scroll_timeout: 10000
        size_hint:1, 4
        id: coverart_carousel
        CoverArtImage:
            mipmap:False
            id: cover_art
            on_press: coverart_carousel.load_next()
        BoxLayout:
            FloatLayout:
                size_hint_x: 0.7
            BoxLayout:
                orientation: "vertical"
                FlatButton:
                    text: "Add Cover Art"
                    on_press: root.add_cover_art()
                FlatButton:
                    text: "Remove Cover Art"
                    on_release: coverart_carousel.load_previous()
                    on_press: root.remove_cover_art
                FlatButton:
                    text: "Cancel"
                    on_release: coverart_carousel.load_previous()
            FloatLayout:
                size_hint_x: 0.7
    HoLine:
    ScrollableLabel:
        size_hint:1, None
        height: 110
        id: lbl_file
        text: "Artist Biography"
        text_size: self.size
        font_size: 15
        valign: "top"
        halign: "left"
    BoxLayout:
        EditorLabel:
            id: lbl_title
            text: "%s"%(icon.icon('fa-music',17,"5c7f8a"))
        EditorTextInput:
            id: InputTitle
            hint_text: "Title"
    BoxLayout:
        EditorLabel:
            id: label_artist
            text: "%s"%(icon.icon('fa-user',17,"5c7f8a"))
        EditorTextInput:
            id: InputArtist
            hint_text: "Artist"
    BoxLayout:
        AlbumLabel:
            size_hint: None,None
            size: 29,29
            canvas:
                Color:
                    rgba: .6, .75, .8, 0.5
                Rectangle:
                    pos: self.pos[0]+6,self.pos[1]+5
                    texture:self.icon_src.texture
                    size: 16,16
        EditorTextInput:
            id: InputAlbum
            hint_text: "Album"
    BoxLayout:
        GenreLabel:
            size_hint: None,None
            size: 29,29
            canvas:
                Color:
                    rgba: .6, .75, .8, 0.5
                Rectangle:
                    pos: self.pos[0]+6,self.pos[1]+5
                    texture:self.icon_src.texture
                    size: 19,19
        EditorTextInput:
            id: InputGenre
            hint_text: "Genre"
    BoxLayout:
        EditorLabel:
            text: "%s"%(icon.icon('fa-hashtag',16,"5c7f8a"))
        EditorTextInput:
            id: InputTracknumber
            input_filter: "int"
            size_hint:None,None
            size: 80,29
            hint_text: "Num"
        FloatLayout:
        EditorLabel:
            text: "%s"%(icon.icon('fa-calendar',16,"5c7f8a"))
        EditorTextInput:
            id: InputDate
            input_filter: "int"
            size_hint:None,None
            size: 80,29
            hint_text: "Year"
    BoxLayout:
        EditorLabel:
            id: lbl_album_artist
            text: "%s"%(icon.icon('fa-users',16,"5c7f8a"))
        EditorTextInput:
            id: InputAlbumartist
            hint_text: "Album Artist"
    SpacedHoLine:
    BoxLayout:
        spacing: self.width / 9
        size_hint: 1,None
        size: 0,36
        orientation: "horizontal"
        FlatButton:
            text: "%s  Rename"%(icon.icon("fa-pencil",16,self.icon_color))
            on_press:
        FlatButton:
            text: "%s  Auto-Tag"%(icon.icon("fa-tag",16,self.icon_color))
            on_press: print self.size
        FlatButton:
            text: "%s  Save"%(icon.icon("fa-floppy-o",16,self.icon_color))
            on_press: app.write_tags()
            markup: True



<ConverterLayout>:
    padding:[10,0,0,10]
    spacing: 0
    orientation: "vertical"
    #Label:
        #size_hint:1,0.1
        #id: converter_label
        #text: "File Converter"
        #font_size: 17
        #bold:True
    SpacingLayout:
    AnimatedBoxLayout:
        size_hint: 1,None
        size: 0,30
        Carousel:
            direction: "bottom"
            scroll_distance:100000000
            scroll_timeout: 10000
            id: converter_carousel
            BoxLayout:
                on_touch_down: converter_carousel.load_next()
                padding: [60,0,5,0]
                spacing: 150
                Label:
                    text: "Convert to:"
                    size_hint: 0.4, 1
                Label:
                    id: filter_label
                    bold: False
                    text: "Format"
            BoxLayout:
                SimpleTransparentButton:
                    text:"FLAC"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
                SimpleTransparentButton:
                    text: "ALAC"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
                SimpleTransparentButton:
                    text: "OGG"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
                SimpleTransparentButton:
                    text: "WMA"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
                SimpleTransparentButton:
                    text: "AIFF"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
                SimpleTransparentButton:
                    text: "MP3"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
    BoxLayout:
        size_hint: 1,0.07
        spacing: self.width / 1.20
        FlatButton:
            text: "%s"%(icon.icon("fa-remove",18,self.icon_color))
            on_press: converter_list.clear_tree_view()
        FlatButton:
            text: "%s"%(icon.icon("fa-bar-chart",18,self.icon_color))
    SpacingLayout:
    BoxLayout:
        size_hint:1,None
        height: 20
        Label:
            text: "Name"
            size_hint: None,1
            width: 50
        FloatLayout:
        Label:
            size_hint: None,1
            width: 60
            text: "Size"
        FloatLayout:
            size_hint: None,1
            width: 1
        Label:
            size_hint: None,1
            width: 50
            text: "Length"
    SpacedHoLine:
    ScrollView:
        scroll_distance: 30
        SelectedList:
            explorer_instance: app.tree_view
            id: converter_list
            size_hint_y:None
            hide_root: True
            on_file_doubleclick: self.remove_from_list(self.selected_node)
            height: self.minimum_height
    SpacingLayout:
    Label:
        text_size: self.size
        halign: "left"
        size_hint:1,None
        height:40
        text: "  {} Songs".format(converter_list.list_counter)
    BoxLayout:
        spacing: 10
        size_hint: 1,None
        size: 0,30
        EditorTextInput:
            id: converter_text_input
            hint_text: "Destination Folder"
        FlatButton:
            size_hint: 0.1,0.98
            markup: True
            text: "%s"%(icon.icon('fa-folder',16,self.icon_color))
            on_press: app.change_dest_folder()
    SpacingLayout:
    SpacedHoLine:
    SpacingLayout:
    BoxLayout:
        spacing: self.width / 10
        size_hint: 1,None
        size: 0,36
        FlatButton:
            size_hint: 1,None
            height: 36
            text: "%s  Convert"%(icon.icon("fa-check",16,self.icon_color))



<MetadorLayout>:
    padding:[10,0,0,10]
    spacing: 0
    orientation: "vertical"
    SpacingLayout:
    BoxLayout:
        size_hint: 1,0.07
        spacing: self.width / 1.20
        FlatButton:
            text: "%s"%(icon.icon("fa-times",18,self.icon_color))
            on_press:metador_list.clear_tree_view()
        FlatButton:
            text: "%s"%(icon.icon("fa-cogs",18,self.icon_color))
    BoxLayout:
        size_hint:1,None
        height: 20
        Label:
            text: "Name"
            size_hint: None,1
            width: 50
        FloatLayout:
        Label:
            size_hint: None,1
            width: 60
            text: "Size"
        FloatLayout:
            size_hint: None,1
            width: 1
        Label:
            size_hint: None,1
            width: 50
            text: "Length"
    SpacedHoLine:
    ScrollView:
        scroll_distance: 30
        SelectedList:
            explorer_instance: app.tree_view
            id: metador_list
            size_hint_y:None
            hide_root: True
            on_file_doubleclick: self.remove_from_list(self.selected_node)
            height: self.minimum_height
    SpacingLayout:
    Label:
        text_size: self.size
        halign: "left"
        size_hint:1,None
        height:20
        text: "  {} Songs".format(metador_list.list_counter)
    SpacedHoLine:
    SpacingLayout:
    BoxLayout:
        padding: [100,0,100,0]
        size_hint: 1, None
        size: 0,36
        orientation: "horizontal"
        FlatButton:
            bold: True
            font_size: 18
            text: "%s   Metador"%(icon.icon("fa-music",18,self.icon_color))
            markup: True


<AppMenuLayout>:
    size_hint:1,None
    size: 0,38
    canvas:
        Color:
            rgba: [.2,.1,.3,.2]
        Rectangle:
            pos:self.pos
            size:self.size
    FlatButton:
        text: "%s"%(icon.icon('fa-bars',17,self.icon_color))
        size_hint:.05,1
        on_press: print app.root_layout.size
    Label:
        text: "Metador"
        font_size: 21
        size_hint: 0.4,1
    FloatLayout:
    FlatButton:
        text: "%s"%(icon.icon("fa-info",16,self.icon_color))
        size_hint: None,1
        width: 40
        on_press: app.about_modal.open()
    FloatLayout:
        size_hint: .01,1
    ProgressSpinner:
        size_hint: None,None
        stroke_width: 1.1
        size: 20,40
        color:  .3, .9, .9, 1
        id: tree_progress
        auto_start: False
        speed:2
    FloatLayout:
        size_hint:0.02,1


<AboutModal>:
    background_color:[0,0,0,0.4]
    background: "res\\images\\tran_back.png"
    size_hint: None,None
    padding: 15,15
    size: 300,350
    BoxLayout:
        spacing: 5
        orientation:"vertical"
        Label:
            size_hint:1,0.2
            text: "Metador Music Application"
            bold:True
            font_size: 16
        Image:
            mipmap:True
            source: "res\\icons\\cd.png"
        Label:
            size_hint:(1,0.1)
            text: "Version 0.3 Pre-Alpha"
            font_size: 13
        BoxLayout:
            spacing: 3
            orientation: "vertical"
            Label:
                font_size: 16
                text:"Developers:"
                bold:True
            Label:
                text:'Gil "Marlo" Harari'
            Label:
                text: 'Omer "Stringer" Buchnik'
            Label:
                text: 'Paz "Carcetti" Newman'
        BoxLayout:
            spacing: 3
            orientation: "vertical"
            Label:
                font_size: 16
                text:"Powered By:"
                bold:True
            Label:
                text:"[ref=kivy][color=0099ff]Kivy[/color][/ref]"
                markup: True
                on_ref_press:webbrowser.open("https://kivy.org/#home")
            Label:
                text:"[ref=kivy][color=0099ff]AcoustID[/color][/ref]"
                markup: True
                on_ref_press:webbrowser.open("https://acoustid.org/")
            Label:
                text:"[ref=kivy][color=0099ff]Pygn[/color][/ref]"
                markup: True
                on_ref_press:webbrowser.open("https://github.com/cweichen/pygn")


<SettingsModal>:
    background_color:[0,0,0,0.4]
    padding: 15,15
    size_hint: None,None
    size: 400,550
    BoxLayout:
        orientation: "vertical"
        Label:
            text: "Settings"
            size_hint: 1,0.2
            font_size: 18
        BoxLayout:
            BoxLayout:
                orientation: "vertical"
                size_hint: 0.3,1
                CheckBox:
                CheckBox:
                CheckBox:
            BoxLayout:
                orientation: "vertical"
                Label:
                    text:"Auto-Tag All Songs"
                Label:
                    text: "Auto Rename by Tags"
                Label:
                    text: "Auto sort in Folders"
        BoxLayout:
            size_hint: 1,0.1
            FlatButton:
                text: "Cancel"
            FlatButton:
                text: "Confirm"
