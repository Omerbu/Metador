#:kivy 1.9.1
#:import webbrowser webbrowser
#:import icon kivy.garden.iconfonts.iconfonts

<RootLayout>:
    padding:[10,15,20,10]
    spacing: 15
    canvas:
        Color:
            rgba:1,1,1,0.45
        Rectangle:
            texture: self.back_texture.texture
            pos:self.pos
            size:self.size

<Label>:
    color:1,1,1,.92

<HoLine@FloatLayout>:
    size_hint:1,None
    height: 2
    canvas:
        Color:
            rgba:[.4, .42, .45, .5]
        Rectangle:
            size: self.size
            pos: self.pos


<SpacedHoLine@FloatLayout>:
    size_hint:1,None
    height: 17
    canvas:
        Color:
            rgba:[.4, .42, .45, .4]
        Rectangle:
            size:(self.size[0],self.size[1]-15)
            pos: self.pos[0] ,self.pos[1] + self.height / 2 -2


<SpacingLayout@FloatLayout>:
    size_hint: 1,None
    height: 15


<TransparentButton>:
    canvas:
        Color:
            rgba:self.line_color
        Line:
            points:[self.pos[0], self.pos[1], self.pos[0]+self.width, self.pos[1],self.pos[0]+self.width, self.pos[1] + self.height,self.pos[0],self.pos[1]+self.height,self.pos[0],self.pos[1]]
        Color:
            rgba:self.shade_color
        Line:
            points:[self.pos[0]+self.width -3, self.pos[1]+3,self.pos[0]+self.width -3, self.pos[1] + self.height -3,self.pos[0]+3,self.pos[1]+self.height-3,self.pos[0]+3,self.pos[1]+3]
            width:1
        Color:
            rgba: self.back_color
        Rectangle:
            pos:self.pos
            size:self.size
    markup:True

<FilterCheckBox@CheckBox>:
    active: True

<LeftLayout>:
    spacing: 2
    size_hint: 1.05,1
    orientation:"vertical"
    AnimatedBoxLayout:
        id:tree_button_layout
        size_hint: 1, None
        size:0,36
        Carousel:
            direction: "bottom"
            scroll_distance:100000000
            scroll_timeout:-1
            anim_move_duration:.6
            id: filter_carousel
            BoxLayout:
                spacing: self.width / 9
                TransparentButton:
                    text:"%s  Change"%(icon.icon('fa-folder',16))
                    on_press: app.drag_modal.open()
                TransparentButton:
                    text:"%s  Refresh"%(icon.icon('fa-refresh',16))
                    on_press: app.tree_refresh()
                TransparentButton:
                    text: "%s  Filter"%(icon.icon('fa-sliders',16))
                    on_release: filter_carousel.load_next()
                ProgressSpinner:
                    size_hint: None,None
                    stroke_width: 1.3
                    size: 25,25
                    color:  .7, .7, .8, .7
                    id: tree_progress
                    auto_start: False
                    speed:2
            BoxLayout:
                GridLayout:
                    spacing: 4
                    cols: 6
                    Label:
                        text:"FLAC"
                    Label:
                        text: "ALAC"
                    Label:
                        text: "OGG"
                    Label:
                        text: "WMA"
                    Label:
                        text: "AIFF"
                    Label:
                        text: "MP3"
                    FilterCheckBox:
                    FilterCheckBox:
                    FilterCheckBox:
                    FilterCheckBox:
                    FilterCheckBox:
                    FilterCheckBox:
                TransparentButton:
                    size_hint: 0.2,1
                    text: "Apply"
                    on_press:
                    on_release: filter_carousel.load_previous()

    SpacedHoLine:


<RightLayout>:
    spacing: 2
    AnimatedBoxLayout:
        size_hint:1,None
        height: 35
        Carousel:
            scroll_distance:100000000
            scroll_timeout:-1
            anim_move_duration: .5
            loop: False
            direction: "top"
            id: chooser_carousel
            BoxLayout:
                spacing: 100
                TransparentButton:
                    size_hint: None,1
                    width: 40
                    text: "%s"%(icon.icon("fa-arrow-left",16))
                    on_press: app.change_editor_carousel_arrow(False)
                TransparentButton:
                    id: chooser_label
                    text: "Tag Editor"
                    font_size: 17
                    bold:True
                    on_press: chooser_carousel.load_next()
                TransparentButton:
                    size_hint: None,1
                    width: 40
                    text: "%s"%(icon.icon("fa-arrow-right",16))
                    on_press: app.change_editor_carousel_arrow()
            BoxLayout:
                spacing: self.width / 9
                TransparentButton:
                    text: "Metador"
                    on_press:chooser_carousel.load_previous()
                    # on_release:  app.change_editor_carousel(0,self.text)
                TransparentButton:
                    text: "Tag Editor"
                    on_press:chooser_carousel.load_previous()
                    on_release:  app.change_editor_carousel(0,self.text)
                TransparentButton:
                    text: "File Converter"
                    on_press:chooser_carousel.load_previous()
                    on_release:  app.change_editor_carousel(1,self.text)




<FileNode>:
    height:node_label.size[1]
    padding: 3,0
    spacing: 10
    Label:
        padding_y: 5
        size: root.width,self.texture_size[1] + 6
        text_size: self.size[0],None
        halign: "left"
        mipmap: False
        bold: False
        shorten: root.shorten
        text: root.text
        shorten_from: "right"
        id: node_label
        canvas:
            Color:
                rgba: .7, .7, .8, 0.35
            Rectangle:
                texture:root.file_icon.texture
                pos: root.pos[0] -20, root.center_y -7
                size: (15, 15)
    Label:
        size_hint: None,1
        width: self.texture_size[0]
        text: "{}MB".format(root.file_size)
    TransparentButton:
        size_hint: None,1
        width: 20
        text: "%s"%(icon.icon("fa-plus",16))
        on_release: app.file_doubleclick_handler(None,root)

<FolderNode>:
    height:node_label.size[1]
    padding: 3,0
    Label:
        padding_y: 5
        size: root.width,self.texture_size[1] + 6
        text_size: self.size[0],None
        halign: "left"
        mipmap: False
        bold: False
        shorten: root.shorten
        text: root.text
        shorten_from: "right"
        id: node_label
        canvas:
            Color:
                rgba: .7, .7, .8, 0.35
            Rectangle:
                texture:root.file_icon.texture
                pos: root.pos[0] -37, root.center_y -7
                size: (17, 13)


<FolderLabel>:
    text_size: root.width, None
    mipmap: True
    bold: False
    padding_y: 5
    size:self.texture_size
    shorten: True
    shorten_from: "right"
    canvas:
        Color:
            rgba: .8, .8, .8, 0.3
        Rectangle:
            texture:root.folder_icon.texture
            pos: root.pos[0] -37, root.center_y -7
            size: (17, 13)

<FileLabel>:
    text_size: root.width, None
    mipmap: True
    bold: False
    padding_y: 5
    size:self.texture_size
    shorten: True
    shorten_from: "right"
    canvas:
        Rectangle:
            texture:root.file_icon.texture
            pos: root.pos[0] -20, root.center_y -7
            size: (15, 15)


<ScrollableLabel>:
    Label:
        size_hint_y: None
        height: self.texture_size[1]
        text_size: self.width, None
        text: root.text
        font_size: root.font_size

<EditorLabel>:
    size_hint: 1,None
    size:0,30
    bold:True

<EditorTextInput@TextInput>:
    size_hint:1,None
    size: 0,29
    multiline: False
    use_bubble: False
    hint_text_color: [.6, .6, .6, 0.5]
    text: ""
    # background_active: "atlas://data/images/defaulttheme/textinput"
    background_color: [0 ,0.1, .1,0.14]
    foreground_color: .9,.9,.9,1
    canvas:
        Color:
            rgba: 1,1,1,1


<TagEditorLayout>:
    orientation: "vertical"
    padding:[10,0,0,10]
    SpacingLayout:
    BoxLayout:
        spacing: 5
        size_hint:1, 4.5
        ScrollableLabel:
            id: lbl_file
            text: "Camel are an English progressive rock band formed in 1971. Led by founding member Andrew Latimer, they have produced 14 original studio albums, 14 singles plus numerous other compilation and live albums."
            text_size: self.size
            font_size: 15
            valign: "top"
            halign: "left"
        CoverArtImage:
            mipmap:True
            size_hint:0.5,1
            on_press: print self.size
    SpacingLayout:
    EditorLabel:
        id: lbl_title
        text: "Title:"
    EditorTextInput:
        id: InputTitle
    EditorLabel:
        id: label_artist
        text: "Artist:"
    EditorTextInput:
        id: InputArtist
    EditorLabel:
        id: lbl_date
        text: "Release Date:"
    EditorTextInput:
        id: InputDate
    EditorLabel:
        id: lbl_tracknumber
        text: "Track Number:"
    EditorTextInput:
        id: InputTracknumber
        input_filter: "int"
    EditorLabel:
        id: lbl_album
        text: "Album:"
    EditorTextInput:
        id: InputAlbum
    EditorLabel:
        id: lbl_genre
        text: "Genre:"
    EditorTextInput:
        id: InputGenre
    EditorLabel:
        id: lbl_album_artist
        text: "Album Artist:"
    EditorTextInput:
        id: InputAlbumartist
    SpacingLayout:
    SpacedHoLine:
    BoxLayout:
        spacing: self.width / 9
        size_hint: 1,None
        size: 0,36
        orientation: "horizontal"
        TransparentButton:
            bold:True
            text: "%s  Clear"%(icon.icon("fa-times",16))
            on_press:
        TransparentButton:
            bold:True
            text: "%s  Auto-Tag"%(icon.icon("fa-music",16))
            on_press: print self.size
        TransparentButton:
            text: "%s  Save"%(icon.icon("fa-floppy-o",16))
            bold:True
            on_press: root.print_text_input()
            markup: True

<FilterButton@TransparentButton>:
    bold:False

<ConverterLayout>:
    padding:[10,0,0,10]
    spacing: 0
    orientation: "vertical"
    #Label:
        #size_hint:1,0.1
        #id: converter_label
        #text: "File Converter"
        #font_size: 17
        #bold:True
    AnimatedBoxLayout:
        size_hint: 1,None
        size: 0,30
        Carousel:
            direction: "bottom"
            scroll_distance:100000000
            id: converter_carousel
            BoxLayout:
                on_touch_down: converter_carousel.load_next()
                padding: [60,0,5,0]
                spacing: 150
                Label:
                    text: "Convert to:"
                    size_hint: 0.4, 1
                Label:
                    id: filter_label
                    bold: False
                    text: "Format"
            BoxLayout:
                FilterButton:
                    text:"FLAC"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
                FilterButton:
                    text: "ALAC"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
                FilterButton:
                    text: "OGG"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
                FilterButton:
                    text: "WMA"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
                FilterButton:
                    text: "AIFF"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
                FilterButton:
                    text: "MP3"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
    SpacedHoLine:
    ScrollView:
        scroll_distance: 30
        ConverterList:
            id: converter_list
            size_hint_y:None
            hide_root: True
            on_file_doubleclick: self.modify_list(self.selected_node)
            height: self.minimum_height
    BoxLayout:
        spacing: 10
        size_hint: 1,None
        size: 0,30
        EditorTextInput:
            id: converter_text_input
            hint_text: "Destination Folder"

        TransparentButton:
            size_hint: 0.1,0.98
            markup: True
            text: "%s"%(icon.icon('fa-folder',18))
            on_press: app.converter_modal.open()
    SpacedHoLine:
    BoxLayout:
        spacing: self.width / 10
        size_hint: 1,None
        size: 0,36
        TransparentButton:
            bold: True
            text: "%s  Clear"%(icon.icon("fa-remove",16))
            on_press: converter_list.clear_tree_view()
        TransparentButton:
            bold: True
            text: "%s  Bitrate"%(icon.icon("fa-bar-chart",16))
        TransparentButton:
            bold:True
            text: "%s  Convert"%(icon.icon("fa-check",16))


<DragModal>:
    opacity: 0.7
    size_hint: (0.35, 0.1)
    background_color:[0,0,0,.5]
    Label:
        opacity: 1.2
        text:

<SpinnerOption>:
    size: 50,28


<BottomLayout>:
    size_hint: 1, None
    size: 0,40
    canvas:
        Color:
            rgba:.4, .42, .45, .2
        Line:
            points:[self.pos[0], self.pos[1], self.pos[0]+self.width, self.pos[1],self.pos[0]+self.width, self.pos[1] + self.height,self.pos[0],self.pos[1]+self.height,self.pos[0],self.pos[1]]
        Color:
            rgba:0, 0, 0, .1
        Line:
            points: [self.pos[1],self.pos[1],self.pos[0]+self.width,self.pos[1]]
            width:16
        Color:
            rgba: 1,1,1,.02
        Rectangle:
            pos:self.pos
            size:self.size
    Carousel:
        loop:True
        id:carousel_id
        scroll_timeout: -1
        FloatLayout:
            AnchorLayout:
                anchor_x: "center"
                anchor_y: "center"
                TransparentButton:
                    id: btn1
                    size_hint: None, 0.8
                    size: 160,0
                    text: "Metador!"
                    bold:True
                    on_press: carousel_id.load_slide(carousel_id.current_slide)
        ProgressBar:
            id: metador_progress_bar

<AppMenuLayout>:
    size_hint:1,None
    size: 0,5
    # DropDownRootButton:
        # dropdown_object:app.about_dropdown
        # background_color:(0,0,0,0)
        # background_color_normal:[0,0,0,0]
        # background_normal: ""
        # text: "About"
        # on_enter: self.dropdown_object.open(self)
        # on_leave: self.leave_handler()
    FloatLayout:
        size_hint:10,1
        canvas:
            Color:
                rgba:0,0,0,0
            Rectangle:
                size: self.size
                pos: self.pos

<AppMenuButton>:
    height: 25
    size_hint_y: None
    background_color:[0,0,0,1]
    background_color_normal:[0,0,0,1]
    background_color_down:[0,0.4,0.8,1]


<AboutDropDown>:
    AppMenuButton:
        background_color_normal:
        text: "Help"
        on_press:
        on_release: root.dismiss()
    AppMenuButton:
        background_color_normal:[0,0,0,1]
        text: 'About'
        on_press:app.about_modal.open()
        on_release: root.dismiss()

<AboutModal>:
    background_color:[0,0,0,0.4]
    size_hint: None,None
    padding: 15,15
    size: 250,350
    BoxLayout:
        spacing: 5
        orientation:"vertical"
        Label:
            size_hint:1,0.2
            text: "Metador Music Application"
            bold:True
            font_size: 16
        Image:
            mipmap:True
            source: "icons\\music_cover.png"
        Label:
            size_hint:(1,0.1)
            text: "Version 0.0.0.1"
            font_size: 13
        BoxLayout:
            spacing: 3
            orientation: "vertical"
            Label:
                font_size: 16
                text:"Creators:"
                bold:True
            Label:
                text:'Gil "Marlo" Harari'
            Label:
                text: 'Omer "Stringer" Buchnik'
            Label:
                text: 'Paz "Carcetti" Newman'
        BoxLayout:
            spacing: 3
            orientation: "vertical"
            Label:
                font_size: 16
                text:"Powered By:"
                bold:True
            Label:
                text:"[ref=kivy][color=0099ff]Kivy[/color][/ref]"
                markup: True
                on_ref_press:webbrowser.open("https://kivy.org/#home")
            Label:
                text:"[ref=kivy][color=0099ff]AcoustID[/color][/ref]"
                markup: True
                on_ref_press:webbrowser.open("https://acoustid.org/")
            Label:
                text:"[ref=kivy][color=0099ff]Pygn[/color][/ref]"
                markup: True
                on_ref_press:webbrowser.open("https://github.com/cweichen/pygn")

