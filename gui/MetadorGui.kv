#:kivy 1.9.1
#:import webbrowser webbrowser
#:import icon kivy.garden.iconfonts.iconfonts

<RootLayout>:
    padding:[0,0,0,20]
    spacing: 15
    canvas:
        Color:
            rgba:1,1,1,.45
        Rectangle:
            texture: self.back_texture.texture
            pos:self.pos
            size:self.size

<Label>:
    color:.9, .95, .95, .9

<HoLine@FloatLayout>:
    size_hint:1,None
    height: 2
    canvas:
        Color:
            rgba:[.4, .6, .65, .35]
        Rectangle:
            size: self.size
            pos: self.pos


<SpacedHoLine@FloatLayout>:
    size_hint:1,None
    height: 17
    canvas:
        Color:
            rgba:[.4, .6, .65, .35]
        Rectangle:
            size:(self.size[0],2)
            pos: self.pos[0] ,self.pos[1] + self.height / 2 -2


<SpacingLayout@FloatLayout>:
    size_hint: 1,None
    height: 15

<BigSpacingLayout@FloatLayout>:
    size_hint: 1,None
    height: 30



<FlatButton>:
    canvas:
        Color:
            rgba:self.underline_color
        Rectangle:
            size: self.size[0]  , 1
            pos:self.pos[0], self.pos[1]
            # points: [self.pos[0]+self.width * .2  , self.pos[1], self.pos[0]+self.width * .8 ,self.pos[1]]
            # width: 1

<FilterCheckBox@CheckBox>:
    active: True

<LeftLayout>:
    spacing: 2
    size_hint: 1.05,1
    orientation:"vertical"
    AnimatedBoxLayout:
        id:tree_button_layout
        size_hint: 1, None
        size:0,36
        Carousel:
            direction: "bottom"
            scroll_distance:100000000
            scroll_timeout: 10
            anim_move_duration:.3
            id: filter_carousel
            BoxLayout:
                spacing: self.width / 9
                FlatButton:
                    text: "%s  Back"%(icon.icon('fa-arrow-left',16,"5c7f8a"))
                    on_press: app.tree_view.is_multiple_selection = False
                FlatButton:
                    text: "%s  Something"%(icon.icon('fa-hourglass',16,"5c7f8a"))
                FlatButton:
                    text: "%s  Add"%(icon.icon('fa-arrow-right',16,"5c7f8a"))
                    on_press: print len(app.tree_view.selected_nodes)
            BoxLayout:
                spacing: self.width / 9
                FlatButton:
                    text:"%s  Change"%(icon.icon('fa-folder',16,"5c7f8a"))
                    on_press: app.drag_modal.open()
                FlatButton:
                    text:"%s  Refresh"%(icon.icon('fa-refresh',16,"5c7f8a"))
                    on_press: app.tree_refresh()
                FlatButton:
                    text: "%s  Filter"%(icon.icon('fa-filter',16,"5c7f8a"))
                    on_release: app.change_carousel(filter_carousel,2)

            BoxLayout:
                GridLayout:
                    spacing: 4
                    cols: 6
                    Label:
                        text:"FLAC"
                    Label:
                        text: "ALAC"
                    Label:
                        text: "OGG"
                    Label:
                        text: "WMA"
                    Label:
                        text: "AIFF"
                    Label:
                        text: "MP3"
                    FilterCheckBox:
                    FilterCheckBox:
                    FilterCheckBox:
                    FilterCheckBox:
                    FilterCheckBox:
                    FilterCheckBox:
                FlatButton:
                    size_hint: 0.2,1
                    text: "Filter"
                    on_press:
                    on_release: app.change_carousel(filter_carousel,1)
    SpacedHoLine:

<CenterLayout>:
    size_hint:1.2,1
    spacing: 2
    AnimatedBoxLayout:
        size_hint:1,None
        height: 35
        BoxLayout:
            padding:30,0,30,0
            spacing: self.width / 10
            ToggleFlatButton:
                text: "Metador"
                on_press:app.change_carousel(app.editor_carousel, 0)
                group: "Converter"
            ToggleFlatButton:
                text: "File Converter"
                on_press:app.change_carousel(app.editor_carousel, 1)
                group: "Converter"


<BorderLessNode>:
    canvas.after:
        Clear

<RootNode>:
    width: self.texture_size[0]
    height: max(self.texture_size[1] + dp(10), dp(24))
    text_size: self.width, None


<FileNode>:
    height:node_label.size[1]
    padding: 5,0
    spacing: 10
    Label:
        padding_y: 5
        size: root.width,self.texture_size[1] + 8
        text_size: self.size[0],None
        halign: "left"
        mipmap: False
        bold: False
        shorten: root.shorten
        text: root.text
        shorten_from: "right"
        id: node_label
        canvas:
            Color:
                rgba: .6, .75, .8, 0.6
            Rectangle:
                texture:root.file_icon.texture
                pos: root.pos[0] -20, root.center_y -7
                size: (15, 15)
    Label:
        size_hint: None,1
        width: self.texture_size[0]
        text: "{} MB".format(root.file_size)
    SimpleTransparentButton:
        size_hint: None,1
        width: 20
        text: "%s"%(icon.icon("fa-plus",16,"5c7f8a"))
        on_release: app.file_doubleclick_handler(None,root)

<FolderNode>:
    height:node_label.size[1]
    padding: 5,0
    Label:
        padding_y: 5
        size: root.width,self.texture_size[1] + 8
        text_size: self.size[0],None
        halign: "left"
        mipmap: True
        bold: False
        shorten: root.shorten
        text: root.text
        shorten_from: "right"
        id: node_label
        canvas:
            Color:
                rgba: .6, .75, .8, 0.5
            Rectangle:
                texture:root.file_icon.texture
                pos: root.pos[0] -37, root.center_y -7
                size: (17, 13)

<ScrollableLabel>:
    canvas:
        Color:
            rgba:.4,.42,.45,0
        Line:
            points:[self.pos[0], self.pos[1], self.pos[0]+self.width, self.pos[1],self.pos[0]+self.width, self.pos[1] + self.height,self.pos[0],self.pos[1]+self.height,self.pos[0],self.pos[1]]
        Color:
            rgba:0,0,0,.0
        Line:
            points:[self.pos[0]+self.width -3, self.pos[1]+3,self.pos[0]+self.width -3, self.pos[1] + self.height -3,self.pos[0]+3,self.pos[1]+self.height-3,self.pos[0]+3,self.pos[1]+3]
            width:1
        Color:
            rgba: 0,0,0,.0
        Rectangle:
            pos:self.pos
            size:self.size
    Label:
        padding:10,10
        size_hint_y: None
        height: self.texture_size[1]
        text_size: self.width, None
        text: root.text
        font_size: root.font_size


<EditorLabel>:
    size_hint: None,None
    size: 29,29
    bold:True
    markup:True

<EditorTextInput>:
    size_hint:1,None
    size: 0,31
    multiline: False
    use_bubble: False
    hint_text_color: [.6, .7, .7, 0.7]
    text: ""
    cursor_color: .4, .8, .8, 1
    background_color: [0 ,0.1, .1,0]
    foreground_color: .9,.9,.9,1
    canvas.after:
        Color:
            rgba: self.underline_color
        Rectangle:
            size: self.size[0], .75
            pos:self.pos


<TagEditorLayout>:
    spacing:15
    orientation: "vertical"
    padding:[10,0,0,10]
    CoverArtImage:
        size_hint:1, 4
        mipmap:True
        on_press: print self.size
    HoLine:
    ScrollableLabel:
        size_hint:1, None
        height: 110
        id: lbl_file
        text: "Camel are an English progressive rock band formed in 1971. Led by founding member Andrew Latimer, they have produced 14 original studio albums, 14 singles plus numerous other compilation and live albums."
        text_size: self.size
        font_size: 15
        valign: "top"
        halign: "left"
    BoxLayout:
        EditorLabel:
            id: lbl_title
            text: "%s"%(icon.icon('fa-music',17,"5c7f8a"))
        EditorTextInput:
            id: InputTitle
            hint_text: "Title"
    BoxLayout:
        EditorLabel:
            id: label_artist
            text: "%s"%(icon.icon('fa-user',17,"5c7f8a"))
        EditorTextInput:
            id: InputArtist
            hint_text: "Artist"
    BoxLayout:
        AlbumLabel:
            size_hint: None,None
            size: 29,29
            canvas:
                Color:
                    rgba: .6, .75, .8, 0.5
                Rectangle:
                    pos: self.pos[0]+6,self.pos[1]+5
                    texture:self.icon_src.texture
                    size: 16,16
        EditorTextInput:
            id: InputAlbum
            hint_text: "Album"
    BoxLayout:
        GenreLabel:
            size_hint: None,None
            size: 29,29
            canvas:
                Color:
                    rgba: .6, .75, .8, 0.5
                Rectangle:
                    pos: self.pos[0]+6,self.pos[1]+5
                    texture:self.icon_src.texture
                    size: 19,19
        EditorTextInput:
            id: InputGenre
            hint_text: "Genre"
    BoxLayout:
        EditorLabel:
            text: "%s"%(icon.icon('fa-hashtag',16,"5c7f8a"))
        EditorTextInput:
            id: InputTracknumber
            input_filter: "int"
            size_hint:None,None
            size: 50,29
            hint_text: "Num"
        FloatLayout:
        EditorLabel:
            text: "%s"%(icon.icon('fa-calendar',16,"5c7f8a"))
        EditorTextInput:
            id: InputDate
            input_filter: "int"
            size_hint:None,None
            size: 50,29
            hint_text: "Year"
    BoxLayout:
        EditorLabel:
            id: lbl_album_artist
            text: "%s"%(icon.icon('fa-users',16,"5c7f8a"))
        EditorTextInput:
            id: InputAlbumartist
            hint_text: "Album Artist"
    SpacedHoLine:
    BoxLayout:
        spacing: self.width / 9
        size_hint: 1,None
        size: 0,36
        orientation: "horizontal"
        FlatButton:
            text: "%s  Rename"%(icon.icon("fa-pencil",16,"5c7f8a"))
            on_press:
        FlatButton:
            text: "%s  Auto-Tag"%(icon.icon("fa-tag",16,"5c7f8a"))
            on_press: print self.size
        FlatButton:
            text: "%s  Save"%(icon.icon("fa-floppy-o",16,"5c7f8a"))
            on_press: root.print_text_input()
            markup: True



<ConverterLayout>:
    padding:[10,0,0,10]
    spacing: 0
    orientation: "vertical"
    #Label:
        #size_hint:1,0.1
        #id: converter_label
        #text: "File Converter"
        #font_size: 17
        #bold:True
    SpacingLayout:
    AnimatedBoxLayout:
        size_hint: 1,None
        size: 0,30
        Carousel:
            direction: "bottom"
            scroll_distance:100000000
            scroll_timeout: 10000
            id: converter_carousel
            BoxLayout:
                on_touch_down: converter_carousel.load_next()
                padding: [60,0,5,0]
                spacing: 150
                Label:
                    text: "Convert to:"
                    size_hint: 0.4, 1
                Label:
                    id: filter_label
                    bold: False
                    text: "Format"
            BoxLayout:
                SimpleTransparentButton:
                    text:"FLAC"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
                SimpleTransparentButton:
                    text: "ALAC"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
                SimpleTransparentButton:
                    text: "OGG"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
                SimpleTransparentButton:
                    text: "WMA"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
                SimpleTransparentButton:
                    text: "AIFF"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
                SimpleTransparentButton:
                    text: "MP3"
                    on_press: filter_label.text = self.text
                    on_release: converter_carousel.load_previous()
    SpacedHoLine:
    ScrollView:
        scroll_distance: 30
        ConverterList:
            id: converter_list
            size_hint_y:None
            hide_root: True
            on_file_doubleclick: self.modify_list(self.selected_node)
            height: self.minimum_height
    SpacingLayout:
    BoxLayout:
        spacing: 10
        size_hint: 1,None
        size: 0,30
        EditorTextInput:
            id: converter_text_input
            hint_text: "Destination Folder"
        FlatButton:
            size_hint: 0.1,0.98
            markup: True
            text: "%s"%(icon.icon('fa-folder',16,"5c7f8a"))
            on_press: app.converter_modal.open()
    SpacingLayout:
    SpacedHoLine:
    SpacingLayout:
    BoxLayout:
        spacing: self.width / 10
        size_hint: 1,None
        size: 0,36
        FlatButton:
            text: "%s  Clear"%(icon.icon("fa-remove",16,"5c7f8a"))
            on_press: converter_list.clear_tree_view()
        FlatButton:
            text: "%s  Bitrate"%(icon.icon("fa-bar-chart",16,"5c7f8a"))
        FlatButton:
            text: "%s  Convert"%(icon.icon("fa-check",16,"5c7f8a"))

<MetadorLayout>:
    padding:[10,0,0,10]
    spacing: 0
    orientation: "vertical"
    SpacingLayout:
    SpacedHoLine:
    SpacingLayout:
    BoxLayout:
        spacing: self.width / 9
        size_hint: 1,None
        size: 0,36
        orientation: "horizontal"
        FlatButton:
            text: "%s  Clear"%(icon.icon("fa-times",16,"5c7f8a"))
            on_press:
        FlatButton:
            text: "%s  Metador!"%(icon.icon("fa-music",16,"5c7f8a"))
            markup: True
        FlatButton:
            text: "%s  Settings"%(icon.icon("fa-cogs",16,"5c7f8a"))

<DragModal>:
    opacity: 0.7
    size_hint: (0.35, 0.1)
    background_color:[0,0,0,.5]
    Label:
        opacity: 1.2
        text:

<SpinnerOption>:
    size: 50,28



<AppMenuLayout>:
    size_hint:1,None
    size: 0,40
    canvas:
        Color:
            rgba: [.1,.2,.2,.4]
        Rectangle:
            pos:self.pos
            size:self.size
    FlatButton:
        text: "%s"%(icon.icon('fa-bars',20,"5c7f8a"))
        size_hint:.05,1
    Label:
        text: "Metador"
        font_size: 21
        size_hint: 0.4,1
    FloatLayout:
    ProgressSpinner:
        size_hint: None,None
        stroke_width: 1.02
        size: 20,40
        color:  .6, .9, .9, 1
        id: tree_progress
        auto_start: False
        speed:2
    FloatLayout:
        size_hint:0.02,1


<AboutModal>:
    background_color:[0,0,0,0.4]
    size_hint: None,None
    padding: 15,15
    size: 250,350
    BoxLayout:
        spacing: 5
        orientation:"vertical"
        Label:
            size_hint:1,0.2
            text: "Metador Music Application"
            bold:True
            font_size: 16
        Image:
            mipmap:True
            source: "icons\\music_cover.png"
        Label:
            size_hint:(1,0.1)
            text: "Version 0.0.0.1"
            font_size: 13
        BoxLayout:
            spacing: 3
            orientation: "vertical"
            Label:
                font_size: 16
                text:"Creators:"
                bold:True
            Label:
                text:'Gil "Marlo" Harari'
            Label:
                text: 'Omer "Stringer" Buchnik'
            Label:
                text: 'Paz "Carcetti" Newman'
        BoxLayout:
            spacing: 3
            orientation: "vertical"
            Label:
                font_size: 16
                text:"Powered By:"
                bold:True
            Label:
                text:"[ref=kivy][color=0099ff]Kivy[/color][/ref]"
                markup: True
                on_ref_press:webbrowser.open("https://kivy.org/#home")
            Label:
                text:"[ref=kivy][color=0099ff]AcoustID[/color][/ref]"
                markup: True
                on_ref_press:webbrowser.open("https://acoustid.org/")
            Label:
                text:"[ref=kivy][color=0099ff]Pygn[/color][/ref]"
                markup: True
                on_ref_press:webbrowser.open("https://github.com/cweichen/pygn")


